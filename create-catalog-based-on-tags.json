[{"name":"Generate a simple product catalog PDF","options":{"cover_image_url":"https://cdn.shopify.com/s/files/1/0232/2232/1188/files/front-background.jpg?v=1680548125","product_tag_to_monitor":"Refresh","products_per_page__number":"3"},"script":"{% assign cover_image_url = options.cover_image_url %}\n{% assign product_tag_to_monitor = options.product_tag_to_monitor %}\n{% assign products_per_page = options.products_per_page__number | default: 6 %}\n\n{% assign cursor = nil %}\n{% assign products_output = array %}\n{% assign product_count = 0 %}\n\n{% for n in (1..100) %}\n  {% capture query %}\n    query {\n      products(\n        first: 250\n        after: {{ cursor | json }}\n        sortKey: TITLE\n        query: \"tag:{{ product_tag_to_monitor }}\"\n      ) {\n        pageInfo {\n          hasNextPage\n          endCursor\n        }\n        nodes {\n          id\n          title\n          featuredImage {\n            url(\n              transform: {\n                maxWidth: 300\n                maxHeight: 300\n                crop: CENTER\n              }\n            )\n          }\n          priceRange {\n            minVariantPrice {\n              amount\n              currencyCode\n            }\n          }\n        }\n      }\n    }\n  {% endcapture %}\n\n  {% assign result = query | shopify %}\n\n  {% if event.preview %}\n    {% capture result_json %}\n      {\n        \"data\": {\n          \"products\": {\n            \"nodes\": [\n              {\n                \"id\": \"gid://shopify/Product/1234567890\",\n                \"title\": \"Widget\",\n                \"featuredImage\": {\n                  \"url\": \"https://cdn.shopify.com/s/files/1/1234/5678/1234/products/widget_300x300_crop_center.jpg?v=1234567890\"\n                }\n              }\n            ]\n          }\n        }\n      }\n    {% endcapture %}\n\n    {% assign result = result_json | parse_json %}\n  {% endif %}\n\n  {% for product in result.data.products.nodes %}\n    {% assign product_count = product_count | plus: 1 %}\n    {% capture product_html %}\n      <div class=\"product-card\">\n        {% if product.featuredImage %}\n          <img class=\"product-image\" src=\"{{ product.featuredImage.url }}\" alt=\"{{ product.title }}\" />\n        {% else %}\n          <div class=\"no-image\">No Image</div>\n        {% endif %}\n        <div class=\"product-info\">\n          <div class=\"product-title\">{{ product.title }}</div>\n        </div>\n      </div>\n    {% endcapture %}\n\n    {% assign products_output = products_output | push: product_html %}\n\n    {% if product_count == products_per_page %}\n      {% assign products_output = products_output | push: '<div class=\"page-break\"></div>' %}\n      {% assign product_count = 0 %}\n    {% endif %}\n  {% endfor %}\n\n  {% if result.data.products.pageInfo.hasNextPage %}\n    {% assign cursor = result.data.products.pageInfo.endCursor %}\n  {% else %}\n    {% break %}\n  {% endif %}\n{% endfor %}\n\n{% capture html %}\n  <html>\n    <head>\n      <style>\n        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap');\n        \n        body {\n          font-family: 'Poppins', sans-serif;\n          background-color: #f4f5f6;\n          margin: 0;\n          padding: 0;\n          width: 8.5in;\n          height: 11in;\n        }\n        h1 {\n          text-align: center;\n          font-size: 28px;\n          margin: 20px 0;\n          color: #574171;\n        }\n        .cover-image {\n          width: 100%;\n          height: auto;\n          margin-bottom: 20px;\n        }\n        .catalog-container {\n          display: grid;\n          grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));\n          gap: 20px;\n          padding: 20px;\n        }\n        .product-card {\n          border: 1px solid #ddd;\n          border-radius: 8px;\n          background-color: #fff;\n          padding: 15px;\n          text-align: center;\n          transition: box-shadow 0.3s;\n        }\n        .product-card:hover {\n          box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n        }\n        .product-image {\n          max-width: 100%;\n          height: auto;\n          margin-bottom: 10px;\n          border-radius: 8px;\n        }\n        .no-image {\n          width: 100%;\n          height: 150px;\n          background-color: #f4f5f6;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          color: #574171;\n          font-size: 12px;\n        }\n        .product-info {\n          margin-top: 10px;\n        }\n        .product-title {\n          font-size: 16px;\n          font-weight: 600;\n          margin-bottom: 8px;\n          color: #574171;\n        }\n        .product-price {\n          font-size: 14px;\n          color: #2aa8bf;\n          font-weight: 600;\n        }\n        .page-break {\n          page-break-after: always;\n        }\n        footer {\n          text-align: center;\n          font-size: 12px;\n          color: #574171;\n          padding: 10px 0;\n          border-top: 1px solid #ddd;\n          margin-top: 20px;\n        }\n      </style>\n    </head>\n    <body>\n      {% if cover_image_url != blank %}\n        <img src=\"{{ cover_image_url }}\" alt=\"Cover Image\" class=\"cover-image\" />\n      {% endif %}\n      <h1>Product Catalog: {{ product_tag_to_monitor }}</h1>\n      <div class=\"catalog-container\">\n        {{ products_output | join: \"\" }}\n      </div>\n      <footer>\n        Generated by Mechanic Task | {{ \"now\" | date: \"%Y\" }}\n      </footer>\n    </body>\n  </html>\n{% endcapture %}\n\n{% action \"files\" %}\n  {\n    \"Catalog-With-Cover-Image.pdf\": {\n      \"pdf\": {\n        \"html\": {{ html | json }}\n      }\n    }\n  }\n{% endaction %}\n","subscriptions":["mechanic/user/trigger"],"online_store_javascript":null,"order_status_javascript":null,"docs":"This task is a simple demonstration of pulling product titles and images into a PDF, resulting in a simple catalog of the products available in your store. Use it as a starting point for building something more complex.\n\nRun this task manually to generate the PDF.","subscriptions_template":"mechanic/user/trigger","shopify_api_version":"2025-01","perform_action_runs_in_sequence":false,"halt_action_run_sequence_on_error":false,"preview_event_definitions":[]}]